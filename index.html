<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA bits -->
  <link rel="manifest" href="manifest.webmanifest?v=1.9.2">
  <meta name="theme-color" content="#0f172a">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <title>Auto Service Intake</title>

  <!-- CSS -->
  <link rel="stylesheet" href="styles/style.css?v=1.9.3" />

  <!-- CSP: allow self + a single hashed inline block for SW registration -->
  <meta http-equiv="Content-Security-Policy"
      content="default-src 'self';
               script-src 'self' 'unsafe-inline';
               style-src 'self' 'unsafe-inline';
               img-src 'self' data:;
               object-src 'none';
               base-uri 'self';
               form-action 'self';
               frame-ancestors 'self';
               upgrade-insecure-requests">
  <meta name="referrer" content="same-origin">
</head>

<body>
  <div class="app">
    <header>
      <h1>Auto Service Intake</h1>
      <div class="right">
        <span id="staffStatus" class="pill">Customer Mode (Locked)</span>
        <button id="btnStaffUnlock" class="btn">Unlock Staff</button>
        <button id="btnStaffLock" class="btn secondary" style="display:none">Lock</button>
        <span id="clock" class="time"></span>
      </div>
    </header>

    <main class="content">
      <!-- All screens render into this -->
      <div id="view"></div>
    </main>
  </div>

  <!-- Staff Login / Recovery Modal (single instance) -->
  <div id="staffLoginModal"
       style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.6);
              align-items:center; justify-content:center;">
    <div class="card" style="width:min(520px, 92%);">
      <h3 style="margin:0 0 8px">Staff Unlock</h3>
      <!-- This <p> is swapped by JS when switching to Recovery mode -->
      <p class="muted" style="margin:0 0 12px">
        Enter your staff passphrase to unlock saved intakes.
      </p>

      <div class="row">
        <label for="staffPassInput">Passphrase</label>
        <input id="staffPassInput" type="password" autocomplete="current-password" inputmode="text" />
      </div>

      <div id="staffLoginError" class="muted"
           style="color:#ef4444; display:none; margin-top:6px"></div>

      <div class="actions">
        <button id="btnStaffSubmit" class="btn primary">Unlock</button>
        <button id="btnStaffCancel" class="btn secondary">Cancel</button>

        <!-- Switch between passphrase and recovery -->
        <a id="linkRecovery" href="#" class="btn ghost">Use Recovery Code</a>
        <a id="linkPass" href="#" class="btn ghost" style="display:none">Use Passphrase</a>
      </div>
    </div>
  </div>

  <!-- Exact-inline SW registration allowed by the CSP hash above -->
  <script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js');
  });
}
  </script>

  <!-- JS (external; defer keeps CSP happy and preserves order) -->
  <script src="js/boot.js?v=1.9.3" defer></script>
  <script src="js/app.js?v=1.9.3" defer></script>
</body>
</html>
